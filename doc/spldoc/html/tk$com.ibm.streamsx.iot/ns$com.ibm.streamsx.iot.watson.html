<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="Namespace com.ibm.streamsx.iot.watson"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_namespace"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>Namespace com.ibm.streamsx.iot.watson</title>
</head>
<body id="spldoc_namespace">


<h1 class="title topictitle1">Namespace <tt class="ph tt">com.ibm.streamsx.iot.watson</tt></h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">IBMStreams com.ibm.streamsx.iot Toolkit</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.iot.html">com.ibm.streamsx.iot 0.7.0.commit_commit_2492b9c</a> &gt; com.ibm.streamsx.iot.watson</p>

</div>

<div class="section">

<p class="p">Connectivity with IBM Watson IoT Platform.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">IBM Watson IoT Platform
</h2>

<p class="p">The <a class="xref" href="https://internetofthings.ibmcloud.com/">IBM Watson Iot Platform</a> service lets your IBM Streams applications communicate with and consume data collected by your connected devices, sensors, and gateways.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Recommended Deployment
</h2>

<p class="p">Use of publish-subscribe is recommended to allow analytic applications to be developed and deployed independent of the connectivity to IBM Watson IoT Platform.
</p>

<p class="p">This is achieved by submitting the <a class="xref" href="spl$com.ibm.streamsx.iot.watson.apps$IotPlatform.html#spldoc_compilationunit__composite_operator__IotPlatform">com.ibm.streamsx.iot.watson.apps::IotPlatform</a> application to IBM Streams. This is the only job that connects to IBM Watson IoT platform, it publishes streams that contain device events, commands and status updates.
</p>

<p class="p">Analytic applications use <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__EventsSubscribe">EventsSubscribe</a>, <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__CommandsSubscribe">CommandsSubscribe</a> and <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__StatusesSubscribe">StatusesSubscribe</a> to subscribe to streams to be analyzed.
</p>

<p class="p">Analytic applications use <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__CommandPublish">CommandPublish</a> to send device commands to individual devices.
</p>

<div class="p">The benefits of this approach are:
<ul class="ul">
<li class="li"> Only a single application (<tt class="ph tt">IotPlatform</tt>) needs to know the authorization tokens.</li>

<li class="li"> Analytic applications can be added and removed at any time without disrupting existing running applications.</li>

</ul>

</div>

<p class="p">Applications may also connect to IBM Watson IoT Platform directly using operators <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceEvents">DeviceEvents</a>, <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceCommands">DeviceCommands</a>, <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceStatuses">DeviceStatuses</a> and <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__SendCommandToDevice">SendCommandToDevice</a>. In this case the application must supply the authorization tokens to connect to IBM Watson IoT Platform, typically through submission time parameters.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Connectivity
</h2>

<p class="p">Connectivty to IBM Watson IoT Platform is through <a class="xref" href="https://docs.internetofthings.ibmcloud.com/applications/mqtt.html">MQTT</a>. By default operators and applications in this toolkit use encrypted connections through port <tt class="ph tt">8883</tt> with TLSv1.2. Operator parameter or submission time parameter <tt class="ph tt">encrypted</tt> can be set to <tt class="ph tt">false</tt> to use unencrypted connections through port <tt class="ph tt">1883</tt>.
</p>

<p class="p"><strong class="ph b">At this point SSL is not supported since the MQTT operators do not yet support TLSv1.2. Use of the operators must set <tt class="ph tt">encrypted</tt> to <tt class="ph tt">false</tt> to see device events and send commands.</strong>
</p>

<p class="p"><strong class="ph b">The applications (<tt class="ph tt">IotPlatform</tt> and <tt class="ph tt">SimpleAllDevices</tt>) are defaulted to unecrypted connections to allow them to work out of the box. The default will revert to encrypted in future pre-release.</strong>
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Device Events
</h2>

<p class="p">Devices publish device events that an SPL application can subscribe to using <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__EventsSubscribe">EventsSubscribe</a> or <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceEvents">DeviceEvents</a>. The default is to subscribe to all event identifiers from all device types and ids. The operator is parameterized to allow only subscribing to a specific event id (which is really the type of the event), a specific device type and/or a specific device using its id.
</p>

<p class="p">The assumption is made that the format of the event is JSON and the resulting stream is of type <a class="xref" href="spl$com.ibm.streamsx.iot$types.html#spldoc_compilationunit__type__DeviceEvent">DeviceEvent</a>. The <tt class="ph tt">jsonString</tt> parameter contains the event payload in serialized JSON. The event payload is a JSON object using <a class="xref" href="https://docs.internetofthings.ibmcloud.com/messaging/payload.html">event format specification</a>, so that the application event data is the value of the <tt class="ph tt">d</tt> key.
</p>

<p class="p">The application event data can be extracted into an SPL tuple using <a class="xref" href="spl$com.ibm.streamsx.iot$extract.html#spldoc_compilationunit__composite_operator__DeviceEventExtractData">com.ibm.streamsx.iot::DeviceEventExtractData</a>. This operator takes an input stream of type <a class="xref" href="spl$com.ibm.streamsx.iot$types.html#spldoc_compilationunit__type__DeviceEvent">DeviceEvent</a> and produces a stream of type <a class="xref" href="spl$com.ibm.streamsx.iot$types.html#spldoc_compilationunit__type__DeviceEventTs">DeviceEventTs</a> augmented with a <tt class="ph tt">dataType</tt> tuple type specified by the application. Since the application event data might be specific to the type of the <tt class="ph tt">eventId</tt> or even the combination of <tt class="ph tt">typeId</tt> and <tt class="ph tt">eventId</tt> an application may need to use a <tt class="ph tt">Split</tt> operator between the <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceEvents">DeviceEvents</a> and multiple <a class="xref" href="spl$com.ibm.streamsx.iot$extract.html#spldoc_compilationunit__composite_operator__DeviceEventExtractData">com.ibm.streamsx.iot::DeviceEventExtractData</a> invocations. An example of its use is in the <a class="xref" href="spl$com.ibm.streamsx.iot.watson.quickstart$quickstart.html#spldoc_compilationunit__composite_operator__Quickstart">com.ibm.streamsx.iot.watson.quickstart::Quickstart</a> application.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Device Status
</h2>

<p class="p">Device status events, such as connect or disconnect, are subscribed to using <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__StatusesSubscribe">StatusesSubscribe</a> or <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceStatuses">DeviceStatuses</a> which produce a stream of type <a class="xref" href="spl$com.ibm.streamsx.iot$types.html#spldoc_compilationunit__type__DeviceStatus">DeviceStatus</a>.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Device Commands
</h2>

<p class="p">Devices can be sent commands, an SPL application can subscribe to commands being sent to devices using <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__CommandsSubscribe">CommandsSubscribe</a> or <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceCommands">DeviceCommands</a>.  The default is to subscribe to all commands identifiers for all device types and ids. The operator is parameterized to allow only subscribing to a specific command id (which is really the type of the command), a specific device type and/or a specific device using its id (<tt class="ph tt">DeviceCommands</tt> only). 
</p>

<p class="p">An SPL application can send a command to a specific device using <a class="xref" href="spl$com.ibm.streamsx.iot$pubsub.html#spldoc_compilationunit__composite_operator__CommandPublish">CommandPublish</a> or <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__SendCommandToDevice">SendCommandToDevice</a> with the input stream type of <a class="xref" href="spl$com.ibm.streamsx.iot$types.html#spldoc_compilationunit__type__DeviceCmd">DeviceCmd</a>. The <tt class="ph tt">jsonString</tt> attribute contains the application specific portion of the command represented as serialized JSON.
</p>

<p class="p">Applications can use <a class="xref" href="spl$com.ibm.streamsx.iot$command.html#spldoc_compilationunit__composite_operator__CommandTupleToPayload">CommandTupleToPayload</a> to convert an SPL tuple representation of the command payload to JSON.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Connectivity using MQTT
</h2>

<p class="p">A Streams application using this toolkit connects to IBM Watson IoT Platform as an <a class="xref" href="https://docs.internetofthings.ibmcloud.com/messaging/applications.html">MQTT application</a>
</p>

<p class="p">Each invocation of an operator in this toolkit (e.g. <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceEvents">DeviceEvents</a>, <a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceStatuses">DeviceStatuses</a>) makes its own MQTT connection using a client identifier of <tt class="ph tt">a:</tt><em class="ph i">org</em><tt class="ph tt">:</tt><em class="ph i">appKey</em><tt class="ph tt">_</tt><em class="ph i">appId</em>. A Streams application must ensure that each operator invocation uses a client identifier that is unique for its <tt class="ph tt">org</tt>. Reuse of client identifiers, even across multiple applications, is not allowed and will result in unexpected disconnection of clients. The default <tt class="ph tt">appId</tt> ensures that the client identifiers will be unique for an instance if there is only a single invocation of each operator kind in an application. In this case the MQTT client identifier is <tt class="ph tt">a:</tt><em class="ph i">org</em><tt class="ph tt">:</tt><em class="ph i">appKey</em><tt class="ph tt">_</tt><em class="ph i">jobId</em><tt class="ph tt">_xxx</tt> where <tt class="ph tt">xxx</tt> is specific to each operator kind.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">JSON Message Format
</h2>

<p class="p">This toolkit supports using JSON as the message format. 
</p>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Operators</h2>
  
<ul class="sl simple">
<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.iot.watson$alldevices.html#spldoc_compilationunit__composite_operator__AllDevices">AllDevices</a></strong>: Composite that produces streams for all devices in an organization.
</li>

<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceCommands">DeviceCommands</a></strong>: Subscribe to device commands for an IBM Watson IoT Platform organization.
</li>

<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceEvents">DeviceEvents</a></strong>: Subscribe to device events for an IBM Watson IoT Platform organization.
</li>

<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__DeviceStatuses">DeviceStatuses</a></strong>: Subscribe to device status events for an IBM Watson IoT Platform organization.
</li>

<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.iot.watson$device.html#spldoc_compilationunit__composite_operator__SendCommandToDevice">SendCommandToDevice</a></strong>: Send commands to devices registered for an IBM Watson IoT Platform organization.
</li>

</ul>

</div>

</div>


</body>
</html>